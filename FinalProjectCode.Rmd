---
title: "Final Project Code"
author: "Kaylin De Silva, Alishah Khan, Cristina Varela"
date: 12-06-2024
output: github_document
---

#loading libraries
```{r}
library(tidyverse)
library(rvest)
library(httr)
```

#loading datasets
```{r}
garden_info = 
  GET("http://data.cityofnewyork.us/resource/p78i-pat6.csv") |> 
  content("parsed") |>
  janitor::clean_names() |>
  drop_na() |>
   mutate(
    borough = 
      recode(
        borough,
        "B" = "Brooklyn",
        "M" = "Manhattan",
        "X" = "Bronx",
        "R" = "Staten Island",
        "Q" = "Queens"
      )
   )

site_visits = 
  GET("http://data.cityofnewyork.us/resource/xqbk-beh5.csv") |>
  content("parsed") |>
  janitor::clean_names()
```

**Flora/Fauna Tab**
#merging the data sets for flora and fauna analysis
```{r}
#cleaning site visit data set so it only includes variables involved in flora and fauna 
site_visits_flora_fauna = site_visits |>
  select(parksid, inspectionid, treesingarden, fruittrees, streettrees, chickens, pond, fishinpond, turtles, totalsidewalkarea) |>
 mutate_at(c('treesingarden', 'fruittrees', 'streettrees', 'chickens', 'pond', 'fishinpond', 'turtles'), as.numeric)

flora_fauna_df= 
  inner_join(garden_info, site_visits_flora_fauna, by = "parksid") 
```

```{r}
flora_fauna_df = flora_fauna_df |>
  group_by(borough) |>
  mutate(
  "Trees in Garden" = sum(treesingarden),
  "Fruit Trees" = sum(fruittrees),
  "Street Trees" = sum(streettrees),
  "Chickens" = sum(chickens),
  "Pond" = sum(pond),
  "Fish in Pond" = sum(fishinpond),
  "Turtles" = sum(turtles)
  )
```

```{r multi-series bar chart reflecting distribution of flora and fauna features by borough}
flora_fauna_tidy = 
   pivot_longer(
    flora_fauna_df, 
    "Trees in Garden":"Turtles",
    names_to = "item", 
    values_to = "total")

ggplot(flora_fauna_tidy, aes(x = borough, y= total, fill=item)) + 
    geom_bar(position="dodge", stat="identity") +
  labs(title = "Distribution of Flaura + Fauna Features in NYC Gardens",
    x = "Borough",
    y = "Number of Gardens with Each Feature by Borough",
    color = "Flora/Fauna Feature",
    caption = "Data from NYC Open Data"
  ) +
    viridis::scale_fill_viridis(
    name = "Flora/Fauna Feature", 
    discrete = TRUE
  )
```

```{r logistic regression for presence of types of trees by borough, controlling for sidewalk area}
fit_logistic_df =
  flora_fauna_df |>
  select('treesingarden', 'fruittrees', 'streettrees', 'borough', 'totalsidewalkarea') |>
  drop_na() |>
  mutate(
    borough = fct_relevel(borough, "Manhattan")
  )

fit_logistic_treesingarden = 
  fit_logistic_df |>
  glm(treesingarden~ borough + totalsidewalkarea, data = _, family = binomial()) 

fit_logistic_fruittrees = 
  fit_logistic_df |>
  glm(fruittrees ~ borough + totalsidewalkarea, data = _, family = binomial())

fit_logistic_streettrees = 
  fit_logistic_df |>
  glm(streettrees ~ borough + totalsidewalkarea, data = _, family = binomial())

fit_logistic_treesingarden |> 
  broom::tidy() |> 
  mutate(OR = exp(estimate)) |>
  select(term, log_OR = estimate, OR, p.value) |> 
  knitr::kable(digits = 3)

fit_logistic_fruittrees |> 
  broom::tidy() |> 
  mutate(OR = exp(estimate)) |>
  select(term, log_OR = estimate, OR, p.value) |> 
  knitr::kable(digits = 3)

fit_logistic_streettrees |> 
  broom::tidy() |> 
  mutate(OR = exp(estimate)) |>
  select(term, log_OR = estimate, OR, p.value) |> 
  knitr::kable(digits = 3)
```

**Eco-Friendly Practices Tab **
#merging and cleaning data for analysis of eco-friendly practices
```{r}
site_visits_eco_friendly = site_visits |>
  select(parksid, inspectionid, rainharvesting, composting, aquaponics, solarpanels) |>
 mutate_at(c('rainharvesting', 'composting', 'aquaponics', 'solarpanels'), as.numeric) 

eco_friendly_df= 
  inner_join(garden_info, site_visits_eco_friendly, by = "parksid") 

```